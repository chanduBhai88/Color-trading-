<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Khatarnak Predictor v8.0</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      background: #000;
      color: #0f0;
      font-family: monospace;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      padding: 20px;
    }

    #randomWord {
      font-size: 28px;
      padding: 10px 20px;
      margin: 10px;
      border: 2px solid #0f0;
      border-radius: 10px;
      animation: glow 1s infinite alternate;
    }

    #timer {
      font-size: 22px;
      margin-bottom: 20px;
      font-weight: bold;
      color: #0f0;
    }

    @keyframes glow {
      from { box-shadow: 0 0 10px #0f0; }
      to   { box-shadow: 0 0 20px #0f0; }
    }

    canvas {
      background: #111;
      border: 1px solid #0f0;
      border-radius: 10px;
      margin-top: 10px;
    }

    table {
      width: 300px;
      border-collapse: collapse;
      margin-top: 20px;
      background: #111;
      border: 1px solid #0f0;
      border-radius: 10px;
    }

    th, td {
      border: 1px solid #0f0;
      padding: 5px 10px;
      text-align: center;
      color: #0f0;
    }

    th {
      background-color: #070;
    }
  </style>
</head>
<body>
  <div id="randomWord">Loading Prediction...</div>
  <div id="timer">00:00</div>
  <canvas id="myChart" width="300" height="200"></canvas>

  <table id="resultTable">
    <thead>
      <tr><th>#</th><th>Result</th><th>Number</th></tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    const API_URL = "https://draw.ar-lottery01.com/api/getResult";
    let lastMinute = -1;
    let history = [];

    const ctx = document.getElementById('myChart').getContext('2d');
    const chart = new Chart(ctx, {
      type: 'bar',
      data: {
        labels: [],
        datasets: [{
          label: 'Prediction Numbers',
          data: [],
          backgroundColor: '#0f0'
        }]
      },
      options: {
        scales: {
          y: { beginAtZero: true, ticks: { color: '#0f0' } },
          x: { ticks: { color: '#0f0' } }
        },
        plugins: { legend: { labels: { color: '#0f0' } } }
      }
    });

    function updateChart(label, numbers) {
      numbers.forEach((num, index) => {
        if (chart.data.labels.length >= 20) {
          chart.data.labels.shift();
          chart.data.datasets[0].data.shift();
        }
        chart.data.labels.push(`${label}-${index + 1}`);
        chart.data.datasets[0].data.push(num);
      });
      chart.update();
    }

    function updateTable() {
      const tbody = document.querySelector("#resultTable tbody");
      tbody.innerHTML = "";
      history.slice().reverse().forEach((entry, index) => {
        const row = document.createElement("tr");
        row.innerHTML = `<td>${history.length - index}</td><td>${entry.result}</td><td>${entry.number}</td>`;
        tbody.appendChild(row);
      });
    }

    async function fetchResultFromServer() {
      try {
        const response = await fetch(API_URL);
        const data = await response.json();
        const number = parseInt(data.number);
        const result = number >= 5 ? "Big" : "Small";
        return { result, number };
      } catch (e) {
        return null;
      }
    }

    function getTwoRandomNumbers(type) {
      const pool = type === "Big" ? [5, 6, 7, 8, 9] : [0, 1, 2, 3, 4];
      const shuffled = pool.sort(() => 0.5 - Math.random());
      return shuffled.slice(0, 2);
    }

    function getSmartPrediction() {
      if (history.length < 3) {
        return {
          result: "Big",
          numbers: getTwoRandomNumbers("Big")
        };
      }

      const lastResults = history.map(x => x.result);
      const last5 = lastResults.slice(-5);
      const last3 = lastResults.slice(-3);
      const last1 = lastResults[history.length - 1];
      const allSame5 = last5.every(r => r === last5[0]);

      if (last5.length === 5 && allSame5) {
        return {
          result: last5[0],
          numbers: getTwoRandomNumbers(last5[0])
        };
      }

      const bigCount = last3.filter(r => r === "Big").length;
      const smallCount = last3.filter(r => r === "Small").length;

      if (bigCount === smallCount) {
        const result = last1 === "Big" ? "Small" : "Big";
        return {
          result,
          numbers: getTwoRandomNumbers(result)
        };
      }

      const result = bigCount > smallCount ? "Small" : "Big";
      return {
        result,
        numbers: getTwoRandomNumbers(result)
      };
    }

    function startTimer() {
      setInterval(async () => {
        const now = new Date();
        const minutes = now.getMinutes();
        const seconds = now.getSeconds();
        document.getElementById('timer').textContent =
          String(minutes).padStart(2, '0') + ':' + String(seconds).padStart(2, '0');

        if (seconds === 0 && lastMinute !== minutes) {
          const realData = await fetchResultFromServer();
          if (realData) {
            history.push(realData);
            if (history.length > 20) history.shift();
          }

          const prediction = getSmartPrediction();
          const text = `ðŸ§  Predicted: ${prediction.result} - ${prediction.numbers.join(', ')}`;
          document.getElementById('randomWord').textContent = text;

          updateChart(prediction.result, prediction.numbers);
          updateTable();

          lastMinute = minutes;
        }
      }, 1000);
    }

    startTimer();
  </script>
</body>
</html>