<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Khatarnak Predictor v6.3</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    :root {
      --bg-color: #000;
      --text-color: #0f0;
      --border-color: #0f0;
      --chart-bg: #111;
    }
    body.light {
      --bg-color: #fff;
      --text-color: #000;
      --border-color: #000;
      --chart-bg: #eee;
    }
    body {
      background: var(--bg-color);
      color: var(--text-color);
      font-family: monospace;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding-top: 30px;
      min-height: 100vh;
      transition: 0.3s ease;
    }
    #randomWord {
      font-size: 28px;
      padding: 10px 20px;
      margin: 10px;
      border: 2px solid var(--border-color);
      border-radius: 10px;
    }
    #timer {
      font-size: 20px;
      margin-bottom: 20px;
    }
    canvas {
      background: var(--chart-bg);
      border: 1px solid var(--border-color);
      border-radius: 10px;
      margin-top: 10px;
    }
    #historyTable {
      margin-top: 20px;
      border-collapse: collapse;
      width: 90%;
      max-width: 400px;
    }
    #historyTable th, #historyTable td {
      border: 1px solid var(--border-color);
      padding: 5px;
      text-align: center;
    }
    .big { color: #0ff; }
    .small { color: #ff0; }
    #modeToggle {
      margin: 15px;
      padding: 6px 12px;
      font-size: 16px;
      border: none;
      background: var(--border-color);
      color: var(--bg-color);
      border-radius: 8px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <button id="modeToggle">Switch to Light Mode</button>
  <div id="randomWord">Loading...</div>
  <div id="timer">00:00</div>
  <canvas id="myChart" width="300" height="200"></canvas>

  <table id="historyTable">
    <thead>
      <tr><th>Time</th><th>Result</th></tr>
    </thead>
    <tbody id="historyBody"></tbody>
  </table>

  <audio id="alertSound" src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg" preload="auto"></audio>

  <script>
    const API_URL = "https://draw.ar-lottery01.com/api/getResult";
    let lastMinute = -1;
    let history = [];
    let lastPrediction = "";

    const ctx = document.getElementById('myChart').getContext('2d');
    const chart = new Chart(ctx, {
      type: 'bar',
      data: {
        labels: [],
        datasets: [{
          label: 'Prediction Number',
          data: [],
          backgroundColor: '#0f0'
        }]
      },
      options: {
        scales: {
          y: { beginAtZero: true, ticks: { color: getComputedStyle(document.body).getPropertyValue('--text-color') } },
          x: { ticks: { color: getComputedStyle(document.body).getPropertyValue('--text-color') } }
        },
        plugins: { legend: { labels: { color: getComputedStyle(document.body).getPropertyValue('--text-color') } } }
      }
    });

    function updateChart(prediction, number) {
      if (chart.data.labels.length >= 10) {
        chart.data.labels.shift();
        chart.data.datasets[0].data.shift();
      }
      chart.data.labels.push(prediction);
      chart.data.datasets[0].data.push(number);
      chart.update();
    }

    function updateHistoryTable(time, result, number) {
      const historyBody = document.getElementById('historyBody');
      const row = document.createElement('tr');
      row.innerHTML = `<td>${time}</td><td class="${result.toLowerCase()}">${result} - ${number}</td>`;
      historyBody.prepend(row);
      while (historyBody.children.length > 5) {
        historyBody.removeChild(historyBody.lastChild);
      }
    }

    async function fetchResultFromServer() {
      try {
        const response = await fetch(API_URL);
        const data = await response.json();
        return { result: data.result, number: data.number };
      } catch (e) {
        return null;
      }
    }

    function smartPredict(historyList) {
      let result = "Big";
      let number = 7;

      if (historyList.length >= 4) {
        const last4 = historyList.slice(-4);
        const bigs = last4.filter(h => h.result === "Big").length;
        const smalls = last4.filter(h => h.result === "Small").length;

        if (bigs >= 3) {
          result = "Small";
        } else if (smalls >= 3) {
          result = "Big";
        } else {
          const last = historyList[historyList.length - 1];
          result = last.result === "Big" ? "Small" : "Big";
        }
      } else {
        result = Math.random() > 0.5 ? "Big" : "Small";
      }

      number = result === "Big"
        ? [5,6,7,8,9][Math.floor(Math.random()*5)]
        : [0,1,2,3,4][Math.floor(Math.random()*5)];

      const current = `${result}-${number}`;
      if (current === lastPrediction) {
        const altNums = result === "Big"
          ? [5,6,7,8,9].filter(n => n !== number)
          : [0,1,2,3,4].filter(n => n !== number);
        number = altNums[Math.floor(Math.random() * altNums.length)];
      }

      lastPrediction = `${result}-${number}`;
      return { result, number };
    }

    function playAlert() {
      const alertSound = document.getElementById('alertSound');
      alertSound.currentTime = 0;
      alertSound.play();
    }

    function startTimer() {
      setInterval(async () => {
        const now = new Date();
        const minutes = now.getMinutes();
        const seconds = now.getSeconds();
        const timeStr = String(minutes).padStart(2, '0') + ':' + String(seconds).padStart(2, '0');
        document.getElementById('timer').textContent = timeStr;

        if (seconds === 0 && lastMinute !== minutes) {
          let data = await fetchResultFromServer();
          if (data) history.push(data);
          const prediction = smartPredict(history);
          document.getElementById('randomWord').textContent = `${prediction.result} - ${prediction.number}`;
          updateChart(prediction.result, prediction.number);
          updateHistoryTable(timeStr, prediction.result, prediction.number);
          playAlert();
          lastMinute = minutes;
        }
      }, 1000);
    }

    document.getElementById('modeToggle').addEventListener('click', () => {
      document.body.classList.toggle('light');
      const isLight = document.body.classList.contains('light');
      document.getElementById('modeToggle').textContent = isLight ? 'Switch to Dark Mode' : 'Switch to Light Mode';
    });

    startTimer();
  </script>
</body>
</html>