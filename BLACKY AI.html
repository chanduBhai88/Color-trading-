<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Khatarnak Predictor v6.4</title>
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(to bottom right, #000000, #4b0082);
      color: #00ff00;
      text-align: center;
      padding: 20px;
    }

    h1 {
      color: #ff0055;
      font-size: 2.2em;
      margin-bottom: 10px;
    }

    #countdown {
      font-size: 28px;
      font-weight: bold;
      margin-bottom: 10px;
      color: #00ffcc;
    }

    #randomWord {
      font-size: 24px;
      margin-bottom: 20px;
      color: #00ffcc;
    }

    #myChart {
      width: 90%;
      max-width: 500px;
      margin: 20px auto;
    }

    table {
      width: 90%;
      max-width: 500px;
      margin: 0 auto;
      border-collapse: collapse;
    }

    th, td {
      padding: 8px;
      border: 1px solid #00ff00;
      color: #fff;
    }

    th {
      background-color: #111;
    }

    .big {
      color: #0f0;
    }

    .small {
      color: #f00;
    }
  </style>
</head>
<body>
  <h1>Khatarnak Predictor v6.4</h1>
  <div id="countdown">Loading...</div>
  <div id="randomWord">Prediction will appear here...</div>
  <canvas id="myChart"></canvas>

  <h3>Recent Predictions</h3>
  <table>
    <thead>
      <tr>
        <th>Time</th>
        <th>Prediction</th>
      </tr>
    </thead>
    <tbody id="historyBody"></tbody>
  </table>

  <audio id="alertSound" src="https://www.soundjay.com/buttons/sounds/beep-07.mp3" preload="auto"></audio>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    const countdownEl = document.getElementById('countdown');
    const alertSound = document.getElementById('alertSound');
    let history = [];

    function updateCountdown() {
      const now = new Date();
      const seconds = now.getSeconds();
      const remaining = 60 - seconds;
      countdownEl.textContent = remaining + 's';
    }

    function playAlert() {
      alertSound.currentTime = 0;
      alertSound.play();
    }

    function smartPredict(historyList) {
      let result = "Big";
      let candidates = [5, 6, 7, 8, 9];

      if (historyList.length >= 4) {
        const last4 = historyList.slice(-4);
        const bigs = last4.filter(h => h.result === "Big").length;
        const smalls = last4.filter(h => h.result === "Small").length;

        if (bigs >= 3) {
          result = "Small";
          candidates = [0, 1, 2, 3, 4];
        } else if (smalls >= 3) {
          result = "Big";
          candidates = [5, 6, 7, 8, 9];
        } else {
          const last = historyList[historyList.length - 1];
          result = last.result === "Big" ? "Small" : "Big";
          candidates = result === "Big" ? [5, 6, 7, 8, 9] : [0, 1, 2, 3, 4];
        }
      } else {
        result = Math.random() > 0.5 ? "Big" : "Small";
        candidates = result === "Big" ? [5, 6, 7, 8, 9] : [0, 1, 2, 3, 4];
      }

      const shuffled = candidates.sort(() => 0.5 - Math.random());
      const pick = shuffled.slice(0, 2);

      return { result, pick };
    }

    function updateChart(prediction, number) {
      const ctx = document.getElementById('myChart').getContext('2d');
      if (!window.myChart) {
        window.myChart = new Chart(ctx, {
          type: 'bar',
          data: {
            labels: [],
            datasets: [{
              label: 'Predicted Number',
              data: [],
              backgroundColor: '#00ffcc'
            }]
          },
          options: {
            scales: {
              y: {
                beginAtZero: true,
                ticks: { color: '#00ffcc' }
              },
              x: {
                ticks: { color: '#00ffcc' }
              }
            },
            plugins: {
              legend: {
                labels: {
                  color: '#00ffcc'
                }
              }
            }
          }
        });
      }

      if (myChart.data.labels.length >= 10) {
        myChart.data.labels.shift();
        myChart.data.datasets[0].data.shift();
      }

      myChart.data.labels.push(prediction.result);
      myChart.data.datasets[0].data.push(number);
      myChart.update();
    }

    function updateHistoryTable(time, result, numberList) {
      const historyBody = document.getElementById('historyBody');
      const row = document.createElement('tr');
      const typeClass = result.toLowerCase();
      row.innerHTML = `<td>${time}</td><td class="${typeClass}">${result} → [${numberList.join(', ')}]</td>`;
      historyBody.prepend(row);
      while (historyBody.children.length > 5) {
        historyBody.removeChild(historyBody.lastChild);
      }
    }

    let lastCheckedMinute = -1;

    setInterval(() => {
      const now = new Date();
      const minutes = now.getMinutes();
      const seconds = now.getSeconds();
      updateCountdown();

      if (seconds === 0 && minutes !== lastCheckedMinute) {
        const prediction = smartPredict(history);
        const pick = prediction.pick;

        document.getElementById('randomWord').textContent =
          `${prediction.result} → [${pick.join(', ')}]`;

        updateChart(prediction, pick[0]);

        const timeStr = String(minutes).padStart(2, '0') + ':' + String(seconds).padStart(2, '0');
        updateHistoryTable(timeStr, prediction.result, pick);

        playAlert();

        history.push({ result: prediction.result });

        lastCheckedMinute = minutes;
      }
    }, 1000);
  </script>
</body>
</html>